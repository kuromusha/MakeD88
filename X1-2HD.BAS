10 CLEAR &HB000
20 drive=1:'ドライブ番号
30 hd=1:'1:2HD, 0:2D
40 IF hd<>0 THEN dma$=HEXCHR$("83 7d fb 0f ff 19 2c 10 80 8d 00 b1 92 cf 87") ELSE dma$=HEXCHR$("83 7d fb 0f ff 0f 2c 10 80 8d 00 b1 92 cf 87")
50 MEM$(&HB000,16)=HEXCHR$("21 00 b1 11 00 d0 01 40 03 d9 01 00 08 1e 00 cb")
60 MEM$(&HB010,16)=HEXCHR$("21 d9 7e 23 d9 fe 80 38 02 cb c1 57 cd 3b b0 7a")
70 MEM$(&HB020,16)=HEXCHR$("83 5f 10 eb 79 cd 3b b0 7b cb 27 cb 79 28 02 f6")
80 MEM$(&HB030,16)=HEXCHR$("01 cd 3b b0 d9 0b 78 b1 20 cf c9 e6 7f c6 20 fe")
90 MEM$(&HB040,10)=HEXCHR$("7f 38 02 c6 32 d9 12 13 d9 c9")
100 IF hd<>0 THEN A=INP(&HFFE) ELSE A=INP(&HFFF)
110 A=INP(&HFFD)
120 OUT &HFFC,&H80 OR drive:GOSUB 350
130 OUT &HFF8,0:GOSUB 350
140 OPEN "C",#1,"COM:6N81R"
150 PRINT #1,"===X1:";
160 IF hd<>0 THEN PRINT #1,"2HD" ELSE PRINT #1,"2D"
170 PRINT #1,"WRITE PROTECT:";
180 IF INP(&HFF8) AND &H40 THEN PRINT #1,"ON" ELSE PRINT #1,"OFF"
190 FOR tr=0 TO 39+hd*37:PRINT TR;:FOR si=0 TO 1
200 OUT &HFFC,&H80 OR drive OR &H10*si:GOSUB 350
210 FOR i=1 TO LEN(dma$):OUT &H1F80,ASC(MID$(dma$,i,1)):NEXT
220 OUT &HFFA,1:OUT &HFF8,&H90:GOSUB 350
230 OUT &H1F80,&H83
240 CALL &HB000
250 OUT &HFFC,drive
260 FOR i=&HD000 TO &HE3FF-(hd<>0)*&HC80 STEP 64:PRINT #1,MEM$(i,64):NEXT
270 NEXT
280 IF tr=39+hd*37 THEN 320
290 OUT &HFFC,&H80 OR drive:GOSUB 350
300 OUT &HFF8,&H58:GOSUB 350
310 OUT &HFFC,drive
320 NEXT
330 PRINT #1,"===END":PRINT:PRINT "END"
340 END
350 count=0
360 IF (INP(&HFF8) AND &H81) = 0 THEN RETURN
370 count=count+1:IF count < 1000 THEN 360
380 PRINT"Err":OUT &HFFC,drive:STOP
